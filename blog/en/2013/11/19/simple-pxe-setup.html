<!DOCTYPE html>
<html>
  <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="keywords" content="Javier López personal blog">
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>simple pxe setup | javier.io</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="simple pxe setup" />
<meta name="author" content="Javier López" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="simple pxe setup" />
<meta property="og:description" content="simple pxe setup" />
<link rel="canonical" href="javier.io/blog/en/2013/11/19/simple-pxe-setup.html" />
<meta property="og:url" content="javier.io/blog/en/2013/11/19/simple-pxe-setup.html" />
<meta property="og:site_name" content="javier.io" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2013-11-19T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="simple pxe setup" />
<meta name="twitter:site" content="@javier_flpz" />
<meta name="twitter:creator" content="@Javier López" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Javier López"},"dateModified":"2013-11-19T00:00:00+00:00","datePublished":"2013-11-19T00:00:00+00:00","description":"simple pxe setup","headline":"simple pxe setup","mainEntityOfPage":{"@type":"WebPage","@id":"javier.io/blog/en/2013/11/19/simple-pxe-setup.html"},"url":"javier.io/blog/en/2013/11/19/simple-pxe-setup.html"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="shortcut icon" href="//javier.io/favicon.ico">
    <link href='//fonts.googleapis.com/css?family=Exo+2:200|PT+Sans|Strait|Vollkorn|' rel='stylesheet' type='text/css'>
    <!--<link href='//fonts.googleapis.com/css?family=Megrim|Ruluko|Exo+2:200|PT+Sans|Strait|Vollkorn|' rel='stylesheet' type='text/css'>-->
    <link rel="alternate" type="application/atom+xml" href="/atom.xml">
    <link rel="stylesheet" type="text/css" href="/assets/css/default_black.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/responsive.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/fontawesome.min.css">

    <!-- syntax http://shjs.sourceforge.net/-->
    <link type="text/css" rel="stylesheet" href="/assets/css/shjs/sh_darkness.css">

    <title>simple pxe setup</title>
  </head>

  <body onload="sh_highlightDocument('/assets/js/lang/', '.js');">
    <div id="header">
  <h1><a href="/blog/">Javier L&oacute;pez</a>
    <form>
      <input type="text" id="st-search-input" class="st-search-input"/>
    </form>
  </h1>

  <a href="/blog/en.html" class="red">[EN]</a> |
  <a href="/blog/pt.html" class="green">[PT]</a> |
  <a href="/blog/es.html" class="yellow">[ES]</a> |
  <a href="/atom.xml" class="rss">RSS</a> |

  

  <!-- Begin Swifttype -->
  <script type="text/javascript">
    var Swiftype = window.Swiftype || {};
    (function() {
      Swiftype.key = 'k64dV6Rm9QK4z8WnkrcN';
      Swiftype.inputElement = '#st-search-input';
      Swiftype.resultContainingElement = '#st-results-container';
      Swiftype.attachElement = '#st-search-input';
      Swiftype.renderStyle = "new_page";
      Swiftype.resultPageURL = "/blog/results/";

      var script = document.createElement('script');
      script.type = 'text/javascript';
      script.async = true;
      script.src = "//swiftype.com/embed.js";
      var entry = document.getElementsByTagName('script')[0];
      entry.parentNode.insertBefore(script, entry);
    }());
  </script>
  <!-- End Swifttype -->


</div>


    <div id="content">
      <div id="post">
  <h2 id="simple-pxe-setup">simple pxe setup</h2>

<h6 id="19-nov-2013">19 Nov 2013</h6>

<p>There are several ways to setup a <a href="http://es.wikipedia.org/wiki/Preboot_Execution_Environment">pxe</a> (which are useful mostly for massive installations), this is my personal method. A preboot execution environment in 68KB with batteries included, pxelinux, dhcpd, tftp, and hands-free installation.</p>

<!--<iframe class="showterm" src="http://showterm.io/f2ac25e4df1e7ad5e989a" width="640" height="300">&nbsp;</iframe>-->
<!--**[![](/assets/img/87.jpg)](/assets/img/87.jpg)**-->

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sh &lt;(wget -qO- https://raw.githubusercontent.com/javier-lopez/learn/master/sh/tools/pxe)
[+] setting pxe environment in ./pxe_setup ...
  - creating ./pxe_setup/menu.c32 ...
  - creating ./pxe_setup/pxelinux.0 ...
  - creating ./pxe_setup/simple-dhcpd ...
  - creating ./pxe_setup/simple-tftpd ...
  - creating ./pxe_setup/pxelinux.cfg/default ...
  - creating ./pxe_setup/ubuntu/ubuntu.menu ...
  - creating ./pxe_setup/pxe/fedora/fedora.menu ...
  - creating ./pxe_setup/tools/tools.menu ...
</code></pre></div></div>

<p>The above command is the heart of the system, a script who creates a directory structure with all the tools and menus required to boot at least ubuntu/fedora (it can personalized to boot other distros). After executing the script, you’ll need to download two extra files; an initrd installer and a linux kernel.</p>

<p>As an example I’ll download the Ubuntu 12.04 amd64 corresponding files:</p>

<ul>
  <li><a href="http://archive.ubuntu.com/ubuntu/dists/precise-updates/main/installer-amd64/current/images/netboot/ubuntu-installer/amd64/linux">linux</a></li>
  <li><a href="http://archive.ubuntu.com/ubuntu/dists/precise-updates/main/installer-amd64/current/images/netboot/ubuntu-installer/amd64/initrd.gz">initrd.gz</a></li>
</ul>

<pre class="sh_sh">
$ wget http://archive.ubuntu.com/.../amd64/initrd.gz -O pxe_setup/ubuntu/1204/amd64/initrd.gz
$ wget http://archive.ubuntu.com/.../amd64/linux     -O pxe_setup/ubuntu/1204/amd64/linux
</pre>

<h2 id="pxe-enabled-router">Pxe enabled router</h2>

<p>Some routers can forward pxe petitions, you can configure them to point all pxe request to the machine running the tftp server (who will provide the pxelinux.0 and other required files) to boot other systems. In this scenarios the ip assigned to the host where this setup was done needs to be entered in the router with the <strong>pxelinux.0</strong> string as path.</p>

<p>And start the tftp daemon in the source machine:</p>

<pre class="sh_sh">
$ cd pxe_setup &amp;&amp; sudo python ./simple-tftpd
</pre>

<h2 id="computer-with-at-least-2-network-interfaces">Computer with at least 2 network interfaces</h2>

<p>If the router cannot forward pxe requests or you don’t have the permissions to do so, you can run a local dhcpd and connect to the target machines through a second network interface (the first one will be used to connect to Internet to download the installation files).</p>

<p>Let’s imagine wlan0 and eth0 are the wireless and wired interfaces of a laptop, the first one is connected to Internet and the second one to other machines through a switch/router or directly. The first step on this scenario is to allow wlan0 to act as a bridge between the target computers and Internet:</p>

<pre class="sh_sh">
$ sudo iptables -t nat -A POSTROUTING -o wlan0 -j MASQUERADE
$ echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward
</pre>

<p>And assign a local ip to the wired interface (eth0):</p>

<pre class="sh_sh">
$ while :; do sudo ifconfig eth0 10.99.88.1; sleep 3; done
</pre>

<p>NOTE: In systems governed by <a href="https://wiki.gnome.org/Projects/NetworkManager">NetworkManager</a> it’s better to use its infrastructure or disable it completely before running the above command.</p>

<p>Finally, the dhcp and tftp daemons can be launched:</p>

<pre class="sh_sh">
$ cd pxe_setup &amp;&amp; sudo python ./simple-dhcpd -i eth0 -a 10.99.88.1
$ cd pxe_setup &amp;&amp; sudo python ./simple-tftpd
</pre>

<p>Upon booting the target machines will print a menu asking for a which system to install (ubuntu or fedora), sweet n_n/</p>

<h2 id="extra-hands-free">extra, hands-free</h2>

<p>Most popular distributions support completely automated installations through preseed, kickstart, etc. This setup is no exception, it’s been configured to provide a hands-free installation for Ubuntu. The preseed file used can be retrieved at:</p>

<ul>
  <li><a href="http://people.ubuntu.com/~javier-lopez/conf/preseed/minimal.preseed">http://people.ubuntu.com/~javier-lopez/conf/preseed/minimal.preseed</a></li>
</ul>

<p>It supports two extra boot parameters:</p>

<ul>
  <li><strong>proxy=http://url</strong>, for using a proxy who doesn’t break the installation process</li>
  <li><strong>user=joe</strong>, for setting a default user (admin by default)</li>
</ul>

<h2 id="uninstallation">uninstallation</h2>

<p>When the installation process ends, the pxe environmente can be easily removed with:</p>

<pre class="sh_sh">
$ rm -rf pxe_setup
</pre>

<p>Simple! 😏</p>

<p><strong>Idea</strong>: Create a vm with 2 network interfaces, the first one in <em>bridge</em> mode assigned to wlan0, and the second one in <em>bridge</em> / <em>internal network</em> assigned to eth0, configure this setup and take an snapshot for an instant pxe installer experience.</p>

<p>References:</p>

<ul>
  <li><a href="https://github.com/psychomario/PyPXE">https://github.com/psychomario/PyPXE</a></li>
  <li><a href="http://javier.io/blog/es/2010/12/14/compartir-conexion-pc-a-pc.html">http://javier.io/blog/es/2010/12/14/compartir-conexion-pc-a-pc.html</a></li>
</ul>

</div>

<div id="related">
  <h5>Related Entries:</h5>
  <ul class="related-posts">
    
    <li><span>22 Aug 2018</span> &raquo; <a href="/blog/en/2018/08/22/minos-a-tiling-wm-linux-distro.html">minos, a tiling wm linux distribution</a></li>
    
    <li><span>01 Jan 2012</span> &raquo; <a href="/blog/en/2012/01/01/bash-autocompletion.html">bash autocompletion</a></li>
    
    <li><span>18 Mar 2013</span> &raquo; <a href="/blog/en/2013/03/18/improve-boot-performance-in-ubuntu-1204.html">improve boot performance in Ubuntu Precise and above</a></li>
    
  </ul>
</div>

    <div id="disqus">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'javierlopez'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
       dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
       })();
     </script>
     <noscript>Enable JavaScript to see/create comments</noscript>
    </div>


    </div>

    
<div id="footer">

  <div class="link" align="right">
    <a href="//javier.io/blog"><i class="icon-pencil"></i></a>
    <a href="//javier.io/pgp"><i class="icon-key"></i></a>
    <a href="//javier.io/twitter"><i class="icon-twitter"></i></a>
    <a href="//javier.io/github"><i class="icon-github-alt"></i></a>
  </div>
</div>

    

    <!-- syntax http://shjs.sourceforge.net/-->
    <script type="text/javascript" src="/assets/js/shjs/shjs_main.js"></script>

    <!-- lightbox http://gettopup.com, the other part of the lib is called in the post.html file-->
    <script type="text/javascript" src="/assets/js/top-up/top_up-min.js"></script>
    <script type="text/javascript">TopUp.host = "//javier.io/";</script>
    <script type="text/javascript">TopUp.images_path = "assets/js/top-up/images/";</script>
    <script type="text/javascript">
      TopUp.addPresets({
          "#content strong a": {
            readAltText: 1,
            effect: "clip",
            overlayClose: 0,
            shaded: 1,
            group: "img"
          }
    });
    </script>

    <!-- google analytics -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-47664650-1']);
      _gaq.push(['_trackPageview']);

      (function() {
       var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
       ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
       var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
       })();
    </script>

  </body>
</html>
