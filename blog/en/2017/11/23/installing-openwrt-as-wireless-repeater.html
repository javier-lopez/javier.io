<!DOCTYPE html>
<html>
  <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="keywords" content="Javier López personal blog">
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>installing openwrt as a wireless repeater | javier.io</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="installing openwrt as a wireless repeater" />
<meta name="author" content="Javier López" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="installing openwrt as a wireless repeater" />
<meta property="og:description" content="installing openwrt as a wireless repeater" />
<link rel="canonical" href="javier.io/blog/en/2017/11/23/installing-openwrt-as-wireless-repeater.html" />
<meta property="og:url" content="javier.io/blog/en/2017/11/23/installing-openwrt-as-wireless-repeater.html" />
<meta property="og:site_name" content="javier.io" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-11-23T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="installing openwrt as a wireless repeater" />
<meta name="twitter:site" content="@javier_flpz" />
<meta name="twitter:creator" content="@Javier López" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Javier López"},"dateModified":"2017-11-23T00:00:00+00:00","datePublished":"2017-11-23T00:00:00+00:00","description":"installing openwrt as a wireless repeater","headline":"installing openwrt as a wireless repeater","mainEntityOfPage":{"@type":"WebPage","@id":"javier.io/blog/en/2017/11/23/installing-openwrt-as-wireless-repeater.html"},"url":"javier.io/blog/en/2017/11/23/installing-openwrt-as-wireless-repeater.html"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="shortcut icon" href="//javier.io/favicon.ico">
    <link href='//fonts.googleapis.com/css?family=Exo+2:200|PT+Sans|Strait|Vollkorn|' rel='stylesheet' type='text/css'>
    <!--<link href='//fonts.googleapis.com/css?family=Megrim|Ruluko|Exo+2:200|PT+Sans|Strait|Vollkorn|' rel='stylesheet' type='text/css'>-->
    <link rel="alternate" type="application/atom+xml" href="/atom.xml">
    <link rel="stylesheet" type="text/css" href="/assets/css/default_black.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/responsive.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/fontawesome.min.css">

    <!-- syntax http://shjs.sourceforge.net/-->
    <link type="text/css" rel="stylesheet" href="/assets/css/shjs/sh_darkness.css">

    <title>installing openwrt as a wireless repeater</title>
  </head>

  <body onload="sh_highlightDocument('/assets/js/lang/', '.js');">
    <div id="header">
  <h1><a href="/blog/">Javier L&oacute;pez</a>
    <form>
      <input type="text" id="st-search-input" class="st-search-input"/>
    </form>
  </h1>

  <a href="/blog/en.html" class="red">[EN]</a> |
  <a href="/blog/pt.html" class="green">[PT]</a> |
  <a href="/blog/es.html" class="yellow">[ES]</a> |
  <a href="/atom.xml" class="rss">RSS</a> |

  

  <!-- Begin Swifttype -->
  <script type="text/javascript">
    var Swiftype = window.Swiftype || {};
    (function() {
      Swiftype.key = 'k64dV6Rm9QK4z8WnkrcN';
      Swiftype.inputElement = '#st-search-input';
      Swiftype.resultContainingElement = '#st-results-container';
      Swiftype.attachElement = '#st-search-input';
      Swiftype.renderStyle = "new_page";
      Swiftype.resultPageURL = "/blog/results/";

      var script = document.createElement('script');
      script.type = 'text/javascript';
      script.async = true;
      script.src = "//swiftype.com/embed.js";
      var entry = document.getElementsByTagName('script')[0];
      entry.parentNode.insertBefore(script, entry);
    }());
  </script>
  <!-- End Swifttype -->


</div>


    <div id="content">
      <div id="post">
  <h2 id="installing-openwrt-as-a-wireless-repeater">installing openwrt as a wireless repeater</h2>

<h6 id="23-nov-2017">23 Nov 2017</h6>

<p>Last weekend I spend some time at my parents house and the occasion was appropriate to extend the wifi signal to cover the whole house, since I don’t intend to repeat the setup in the nearby future but would like still to have a reference, I decided to wrap it up in a post ☺</p>

<p>First thing I did was to grab a TP-Link N750, formally a <a href="http://www.amazon.com/TP-LINK-TL-WDR4300-Wireless-Gigabit-300Mbps/dp/B0088CJT4U">TL-WDR4300 Version 1.7</a> router for $60 at a nearby shop, I didn’t choose it for anything particular, but because of its nice antennas and dual-band support.</p>

<p><strong><a href="/assets/img/98.jpg"><img src="/assets/img/98.jpg" alt="" /></a></strong></p>

<p>Getting the latest openwrt <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/">trunk build</a> and install it on the device is pretty straight forward.</p>

<pre class="sh_sh">
$ wget downloads.openwrt.org/snapshots/trunk/ar71xx/generic/openwrt-ar71xx-generic-tl-wdr4300-v1-squashfs-factory.bin
</pre>

<p>Or to upgrade it from a previous release:</p>

<pre class="sh_sh">
$ wget downloads.openwrt.org/snapshots/trunk/ar71xx/generic/openwrt-ar71xx-generic-tl-wdr4300-v1-squashfs-sysupgrade.bin
</pre>

<p>To flash the image go to the <strong>System Tools ▷ Firmware Upgrade</strong> menu</p>

<p><strong><a href="/assets/img/99.png"><img src="/assets/img/99.png" alt="" /></a></strong></p>

<p>Be aware that the trunk build is minimal, it doesn’t include the <a href="luci.subsignal.org">luci web interface</a>, so it’s up to every person to decide if they want it or not.</p>

<p>To install additional software connect to the device and share temporary your laptop/desktop internet</p>

<pre class="sh_sh">
# flush previous iptables rules
$ sudo iptables -F
$ sudo iptables -X
$ sudo iptables -t nat -F
$ sudo iptables -t nat -X
$ sudo iptables -t mangle -F
$ sudo iptables -t mangle -X
$ sudo iptables -P INPUT ACCEPT
$ sudo iptables -P FORWARD ACCEPT
$ sudo iptables -P OUTPUT ACCEPT
</pre>

<pre class="sh_sh">
# route laptop traffic through wlan0 (wireless) interface
$ sudo iptables -t nat -A POSTROUTING -o wlan0 -j MASQUERADE
$ echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward
$ while true; do sudo ifconfig eth0 192.168.1.2; sleep 1; done
$ telnet 192.168.1.1 #type "passwd" to set the root passwd
# be aware than in current openwrt releases telnet is no longer provided
# in those cases just skip this step
$ ssh root@192.168.1.1 #from other terminal window
openwrt # passwd #set the root passwd in case telnet service wasn't available
openwrt # ifconfig br-lan 10.9.8.7
$ while true; do sudo ifconfig eth0 10.9.8.10; sleep 1; done #bypass networkmanager
$ ssh root@10.9.8.7
openwrt # route add default gw 10.9.8.10
openwrt # echo "nameserver 8.8.8.8" &gt; /etc/resolv.conf
openwrt # opkg update
openwrt # opkg install luci relayd
openwrt # /etc/init.d/uhttpd enable
openwrt # /etc/init.d/uhttpd start
openwrt # /etc/init.d/relayd enable
openwrt # /etc/init.d/relayd start
</pre>

<p>Upon completing the installation, go to the web interface, <a href="http://10.9.8.7">http://10.9.8.7</a>, and reconfigure the LAN interface to make permanent the IP address:</p>

<ul>
  <li>Network ▷ Interfaces ▷ LAN</li>
</ul>

<p><strong><a href="/assets/img/100.png"><img src="/assets/img/100.png" alt="" /></a></strong></p>

<p>Now, it’s time to create the bridge interface (bonding the <strong>lan</strong> and <strong>wwan</strong> interfaces)</p>

<p><strong><a href="/assets/img/101.png"><img src="/assets/img/101.png" alt="" /></a></strong></p>

<p><strong><a href="/assets/img/openwrt-bridge.png"><img src="/assets/img/openwrt-bridge.png" alt="" /></a></strong></p>

<p>And join the nearby AP (linked to the <strong>bridge/wwan</strong> interface)</p>

<ul>
  <li>Network ▷ Wifi ▷ Scan</li>
</ul>

<p><strong><a href="/assets/img/openwrt-client.png"><img src="/assets/img/openwrt-client.png" alt="" /></a></strong></p>

<p>Finally, don’t forget to create the AP repeater (linked to the <strong>lan</strong> interface)</p>

<ul>
  <li>Network ▷ Wifi ▷ Add</li>
</ul>

<p><strong><a href="/assets/img/openwrt-ap.png"><img src="/assets/img/openwrt-ap.png" alt="" /></a></strong></p>

<p>That’s it!, a simple and robust wifi extender ✌</p>

<ul>
  <li><a href="http://wiki.openwrt.org/toh/tp-link/tl-wdr4300">http://wiki.openwrt.org/toh/tp-link/tl-wdr4300</a></li>
  <li><a href="http://tombatossals.github.io/openwrt-repetidor-wireless/">http://tombatossals.github.io/openwrt-repetidor-wireless/</a></li>
</ul>

</div>

<div id="related">
  <h5>Related Entries:</h5>
  <ul class="related-posts">
    
    <li><span>24 Nov 2017</span> &raquo; <a href="/blog/en/2017/11/24/installing-openwrt-as-access-point.html">installing openwrt as an access point</a></li>
    
    <li><span>14 Dec 2010</span> &raquo; <a href="/blog/en/2010/12/14/share-connection-between-personal-computers.html">share connection between personal computers</a></li>
    
    <li><span>19 Nov 2013</span> &raquo; <a href="/blog/en/2013/11/19/simple-pxe-setup.html">simple pxe setup</a></li>
    
  </ul>
</div>

    <div id="disqus">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'javierlopez'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
       dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
       })();
     </script>
     <noscript>Enable JavaScript to see/create comments</noscript>
    </div>


    </div>

    
<div id="footer">

  <div class="link" align="right">
    <a href="//javier.io/blog"><i class="icon-pencil"></i></a>
    <a href="//javier.io/pgp"><i class="icon-key"></i></a>
    <a href="//javier.io/twitter"><i class="icon-twitter"></i></a>
    <a href="//javier.io/github"><i class="icon-github-alt"></i></a>
  </div>
</div>

    

    <!-- syntax http://shjs.sourceforge.net/-->
    <script type="text/javascript" src="/assets/js/shjs/shjs_main.js"></script>

    <!-- lightbox http://gettopup.com, the other part of the lib is called in the post.html file-->
    <script type="text/javascript" src="/assets/js/top-up/top_up-min.js"></script>
    <script type="text/javascript">TopUp.host = "//javier.io/";</script>
    <script type="text/javascript">TopUp.images_path = "assets/js/top-up/images/";</script>
    <script type="text/javascript">
      TopUp.addPresets({
          "#content strong a": {
            readAltText: 1,
            effect: "clip",
            overlayClose: 0,
            shaded: 1,
            group: "img"
          }
    });
    </script>

    <!-- google analytics -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-47664650-1']);
      _gaq.push(['_trackPageview']);

      (function() {
       var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
       ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
       var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
       })();
    </script>

  </body>
</html>
