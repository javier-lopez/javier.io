<!DOCTYPE html>
<html>
  <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="keywords" content="Javier L√≥pez personal blog">
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>the most portable language in the world, awk | javier.io</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="the most portable language in the world, awk" />
<meta name="author" content="Javier L√≥pez" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="the most portable language in the world, awk" />
<meta property="og:description" content="the most portable language in the world, awk" />
<link rel="canonical" href="javier.io/blog/en/2014/02/22/awk.html" />
<meta property="og:url" content="javier.io/blog/en/2014/02/22/awk.html" />
<meta property="og:site_name" content="javier.io" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-02-22T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="the most portable language in the world, awk" />
<meta name="twitter:site" content="@javier_flpz" />
<meta name="twitter:creator" content="@Javier L√≥pez" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Javier L√≥pez"},"dateModified":"2014-02-22T00:00:00+00:00","datePublished":"2014-02-22T00:00:00+00:00","description":"the most portable language in the world, awk","headline":"the most portable language in the world, awk","mainEntityOfPage":{"@type":"WebPage","@id":"javier.io/blog/en/2014/02/22/awk.html"},"url":"javier.io/blog/en/2014/02/22/awk.html"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="shortcut icon" href="//javier.io/favicon.ico">
    <link href='//fonts.googleapis.com/css?family=Exo+2:200|PT+Sans|Strait|Vollkorn|' rel='stylesheet' type='text/css'>
    <!--<link href='//fonts.googleapis.com/css?family=Megrim|Ruluko|Exo+2:200|PT+Sans|Strait|Vollkorn|' rel='stylesheet' type='text/css'>-->
    <link rel="alternate" type="application/atom+xml" href="/atom.xml">
    <link rel="stylesheet" type="text/css" href="/assets/css/default_black.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/responsive.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/fontawesome.min.css">

    <!-- syntax http://shjs.sourceforge.net/-->
    <link type="text/css" rel="stylesheet" href="/assets/css/shjs/sh_darkness.css">

    <title>the most portable language in the world, awk</title>
  </head>

  <body onload="sh_highlightDocument('/assets/js/lang/', '.js');">
    <div id="header">
  <h1><a href="/blog/">Javier L&oacute;pez</a>
    <form>
      <input type="text" id="st-search-input" class="st-search-input"/>
    </form>
  </h1>

  <a href="/blog/en.html" class="red">[EN]</a> |
  <a href="/blog/pt.html" class="green">[PT]</a> |
  <a href="/blog/es.html" class="yellow">[ES]</a> |
  <a href="/atom.xml" class="rss">RSS</a> |

  

  <!-- Begin Swifttype -->
  <script type="text/javascript">
    var Swiftype = window.Swiftype || {};
    (function() {
      Swiftype.key = 'k64dV6Rm9QK4z8WnkrcN';
      Swiftype.inputElement = '#st-search-input';
      Swiftype.resultContainingElement = '#st-results-container';
      Swiftype.attachElement = '#st-search-input';
      Swiftype.renderStyle = "new_page";
      Swiftype.resultPageURL = "/blog/results/";

      var script = document.createElement('script');
      script.type = 'text/javascript';
      script.async = true;
      script.src = "//swiftype.com/embed.js";
      var entry = document.getElementsByTagName('script')[0];
      entry.parentNode.insertBefore(script, entry);
    }());
  </script>
  <!-- End Swifttype -->


</div>


    <div id="content">
      <div id="post">
  <h2 id="the-most-portable-language-in-the-world-awk">the most portable language in the world, awk</h2>

<h6 id="22-feb-2014">22 Feb 2014</h6>

<p><strong><a href="/assets/img/93.png"><img src="/assets/img/93.png" alt="" /></a></strong></p>

<p>The other day while I was browsing I found an article called ‚Äú<a href="http://www.computerworld.com.au/article/216844/a-z_programming_languages_awk/">The awk origins</a>‚Äù, I liked so much than I decided to learn awk (it‚Äôs pronounced ‚Äúauk‚Äù). I had already used one-liners but considered larger awk programs unfriendly and its syntax over complicated, however once I started diving on it and unbelief my fears I found it quite fun and easy to use, what a powerful tool based on minimal principles!</p>

<h2 id="awk-an-event-drive-language">Awk, an event drive language</h2>

<p>The most important thing in awk (and what took me more time to learn) was to understand that it‚Äôs an event drive language based in 5 important areas:</p>

<ul>
  <li><strong>begin</strong></li>
  <li><strong>body</strong>
    <ul>
      <li><strong>search</strong></li>
      <li><strong>action</strong></li>
    </ul>
  </li>
  <li><strong>end</strong></li>
</ul>

<p>This means that every awk program (even the smallest ones) have a begin, body and end sections. The begin and end sections are similar, they‚Äôre executed only once, at the beginning and at the end of the program, to write the classic ‚ÄúHello World‚Äù a person can do it in both sections:</p>

<pre class="sh_sh">
$ awk 'BEGIN {print "Hello World"}' &lt; /dev/null
Hello World
$ awk 'END   {print "Hello World"}' &lt; /dev/null
Hello World
</pre>

<p>Every section is defined by its name and its actions (which are defined between {}). Awk programs are written between (‚Äò) so the shell doesn‚Äôt interpret any variable or keywords. Awk programs can also be written in files and be executed directly:</p>

<pre class="sh_sh">
$ cat hello.awk
#!/usr/bin/awk -f
BEGIN {print "Hello World"}
$ ./hello.awk
Hello World
</pre>

<p>In between, is the body section, the most powerful one, it defines search patterns and related actions.</p>

<pre class="sh_sh">
$ awk '/.*/ {print $0}' file
</pre>

<p>The above line is comparable to <strong>$(cat file)</strong>, the search pattern is <strong>/.*/</strong> (any character) and the action is <strong>{print $0}</strong> (print current line). The body section is executed once per line, if a file contain 10 lines, the body section will be executed 10 times and will print all the content. Any length of pattern-actions can be declared within an awk program. The next example will look for <strong>daemon</strong> and <strong>root</strong> and will print every line where awk finds those strings.</p>

<pre class="sh_sh">
$ awk '/root/ {print $0} /daemon/ {print $0}' /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/bin/sh
</pre>

<p>If no search pattern is defined for an action, the action will be executed once per line, if no action is defined for a search pattern the default action will be to print the current line, if no parameter is given to <strong>print</strong> it will print the whole line (<strong>$0</strong>). Therefore the above examples can be rewritten as follows:</p>

<pre class="sh_sh">
$ awk '{print $0}' file
$ awk '{print}'    file

$ awk '/root/ || /daemon/ {print $0}' /etc/passwd
$ awk '/root/ || /daemon/ {print}'    /etc/passwd
$ awk '/root/ || /daemon/'            /etc/passwd
</pre>

<p>These alternatives ways of writing awk programs (I think) are part of the reason why awk seems like a cryptographic language and why so many awk programs are tiny. Awk also defines default variables, some of the most important are:</p>

<blockquote>
  <p>NR = Number of Record (line number)</p>
</blockquote>

<blockquote>
  <p>NF = Number of Field</p>
</blockquote>

<blockquote>
  <p>RS = Record separator (\n by default)</p>
</blockquote>

<blockquote>
  <p>FS = Field separator  (white spaces by default)</p>
</blockquote>

<p>If you‚Äôve a file with the content:</p>

<pre class="lyric">
1 2 3
4 5 6
</pre>

<p>Awk will see 2 records and 3 fields. So, <strong>$(cat -n file)</strong> can be emulated in awk with:</p>

<pre class="sh_sh">
$ awk '{print NR, $0}' file
</pre>

<p>As the search pattern is missing, the action will be executed once for every line, and for every time it will print <strong>NR</strong> plus the whole line, <strong>NR</strong> will increase +1 in every iteration, that‚Äôs a lot of things happening in a minuscule definition. Let‚Äôs review other example, <strong>$(wc -l)</strong>:</p>

<pre class="sh_sh">
$ awk 'END {print NR}'      file
$ awk '{i++} END {print i}' file
</pre>

<p><strong>NR</strong> will always increment, so in the first program when the END sections gets executed it will print the total amount of lines in the file. The second example is easier to analyze, it doesn‚Äôt have a search pattern so the action (i++) will always be executed and at the end the program it will be printed. Its amazing how easily other Unix core utilities can be implemented in a simple line, let‚Äôs now copy <strong>$(head)</strong> behavior:</p>

<pre class="sh_sh">
$ awk 'NR &lt;= 10'          file
$ awk -v hl=10 'NR &lt;= hl' file
</pre>

<p>Does it make sense?, awk is not as difficult as it seems üòâ. Sed can also be emulated:</p>

<pre class="sh_sh">
$ awk '{gsub(/original/,"replace"); print}' file
$ awk 'function sed(search, replace) { gsub(search,replace); print } {sed("search","replace")}' file
</pre>

<p>Awk can also use control structures and functions, in the first example it uses de gsub function to replace all original string with ‚Äúreplace‚Äù in a file, just as sed would do it. In the second one, a function called ‚Äúsed‚Äù is defined and used to replace the same strings. Awk is a complete turing language, so even though it could be seen as a toy tool, it‚Äôs a powerful tool which can be used to build sotisficated programs. Nevertheless if you‚Äôve read till this phrase you already know its core principles and are ready to take advantage of its power.</p>

<p>I‚Äôm leaving some more example to get started, can you guess how do they work?</p>

<h2 id="awk-as-unix-swiss-army-knife">Awk as Unix swiss army knife</h2>

<pre class="sh_sh">
cat file                 &#x25B7; awk '{print}' file
cat -n file              &#x25B7; awk '{print NR, $0}' file
cat -n file              &#x25B7; awk '{print FNR, $0}' file
head file                &#x25B7; awk 'NR &lt;= 10' file
head -15 file            &#x25B7; awk -v hl=15 'NR &lt;= hl' file
cut -d: -f1 /etc/passwd  &#x25B7; awk -F":" '{print $1}' /etc/passwd
cut -d: -f1 /etc/passwd  &#x25B7; awk 'BEGIN {FS=":"} {print $1}' /etc/passwd
wc -l file               &#x25B7; awk '{i++} END {print i}' file
wc -l file               &#x25B7; awk 'END {print NR}' file
wc -w file               &#x25B7; awk '{total = total + NF}; END {print total+0}' file
grep pattern file        &#x25B7; awk '/pattern/' file
grep -v pattern file     &#x25B7; awk '!/pattern/' file
sed 's/foo/bar/g'        &#x25B7; awk '{gsub(/foo/,"bar"); print $0}' file
tail file                &#x25B7; awk -v tl=10 '{a=a b $0;b=RS;if(NR&lt;=tl)next;a=substr(a,index(a,RS)+1)}END{print a}' file
tail - 15 file           &#x25B7; awk -v tl=15 '{a=a b $0;b=RS;if(NR&lt;=tl)next;a=substr(a,index(a,RS)+1)}END{print a}' file
tac file                 &#x25B7; awk '{a[i++]=$0} END {for (j=i-1; j&gt;=0;) print a[j--] }' file
uniq file                &#x25B7; awk 'a !~ $0; {a=$0}'
</pre>

<h2 id="awk-one-liners">Awk one-liners</h2>

<pre class="sh_sh">
awk '$2  ~ /pattern/'  file               #print line when second field matches pattern
awk '$2 !~ /^[0-9]+$/' file               #print line when second field is not a number
awk '1; {print ""}' file                  #adds double space
awk 'BEGIN {ORS="\n\n"}; 1' file          #adds double space
awk 'NF {print $0 "\n"}' file             #adds double space to lines with content
awk 'BEGIN {RS="";ORS="\n\n"}/pattern/'   #print whole paragrams where pattern is found
awk '{print $NF}' file                    #print the last field of every line
awk '{field=$NF} END{print field}' file   #print the last field of the last line
awk 'NF &gt; 4' file                         #print lines with more than 4 fields
awk '{sub(/^[ \t]+/, "");print}' file     #delete white spaces at the beggining of a line
awk '{sub(/[ \t]+$/, "");print}' file     #delete white spaces at the end of a line
awk '{gsub(/^[ \t]+|[ \t]+$/, "");print}' #delete white spaces at the beggining and end of a line
awk '{$2=""; print}'  file                #delete the 2nd field of every line
awk '/AAA|BBB|CCC/'   file                #search and print "AAA", "BBB" or "CCC"
awk '/AAA.*BBB.*CCC/' file                #search and print "AAA", "BBB" and "CCC" in that order
</pre>

<p>References</p>

<ul>
  <li><a href="http://awk.info">http://awk.info</a></li>
  <li><a href="http://www.staff.science.uu.nl/~oostr102/docs/nawk/nawk_toc.html">http://www.staff.science.uu.nl/~oostr102/docs/nawk/nawk_toc.html</a></li>
  <li><a href="http://www.grymoire.com/Unix/Awk.html">http://www.grymoire.com/Unix/Awk.html</a></li>
  <li><a href="http://blog.bignerdranch.com/3799-a-crash-course-in-awk/">http://blog.bignerdranch.com/3799-a-crash-course-in-awk/</a></li>
  <li><a href="http://f.javier.io/public/books/The_AWK_Programming_Language.pdf">The Awk Programming Language (1988) [pdf]</a></li>
</ul>

</div>

<div id="related">
  <h5>Related Entries:</h5>
  <ul class="related-posts">
    
    <li><span>01 Jan 2012</span> &raquo; <a href="/blog/en/2012/01/01/bash-autocompletion.html">bash autocompletion</a></li>
    
    <li><span>21 Oct 2014</span> &raquo; <a href="/blog/en/2014/10/21/hints-in-writing-unix-tools-with-shell-scripting.html">hints for writing unix tools with shell scripting</a></li>
    
    <li><span>26 Jan 2014</span> &raquo; <a href="/blog/en/2014/01/26/introduction-to-drupal-7-installation-profiles.html">introduction to drupal 7 installation profiles</a></li>
    
  </ul>
</div>

    <div id="disqus">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'javierlopez'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
       dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
       })();
     </script>
     <noscript>Enable JavaScript to see/create comments</noscript>
    </div>


    </div>

    
<div id="footer">

  <div class="link" align="right">
    <a href="//javier.io/blog"><i class="icon-pencil"></i></a>
    <a href="//javier.io/pgp"><i class="icon-key"></i></a>
    <a href="//javier.io/twitter"><i class="icon-twitter"></i></a>
    <a href="//javier.io/github"><i class="icon-github-alt"></i></a>
  </div>
</div>

    

    <!-- syntax http://shjs.sourceforge.net/-->
    <script type="text/javascript" src="/assets/js/shjs/shjs_main.js"></script>

    <!-- lightbox http://gettopup.com, the other part of the lib is called in the post.html file-->
    <script type="text/javascript" src="/assets/js/top-up/top_up-min.js"></script>
    <script type="text/javascript">TopUp.host = "//javier.io/";</script>
    <script type="text/javascript">TopUp.images_path = "assets/js/top-up/images/";</script>
    <script type="text/javascript">
      TopUp.addPresets({
          "#content strong a": {
            readAltText: 1,
            effect: "clip",
            overlayClose: 0,
            shaded: 1,
            group: "img"
          }
    });
    </script>

    <!-- google analytics -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-47664650-1']);
      _gaq.push(['_trackPageview']);

      (function() {
       var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
       ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
       var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
       })();
    </script>

  </body>
</html>
