<!DOCTYPE html>
<html>
  <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="keywords" content="Javier López personal blog">
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>backups with rsync and rdiff-backup | javier.io</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="backups with rsync and rdiff-backup" />
<meta name="author" content="Javier López" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="backups with rsync and rdiff-backup" />
<meta property="og:description" content="backups with rsync and rdiff-backup" />
<link rel="canonical" href="javier.io/blog/en/2014/04/08/backups-git-rsync-rdiff-backup.html" />
<meta property="og:url" content="javier.io/blog/en/2014/04/08/backups-git-rsync-rdiff-backup.html" />
<meta property="og:site_name" content="javier.io" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-04-08T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="backups with rsync and rdiff-backup" />
<meta name="twitter:site" content="@javier_flpz" />
<meta name="twitter:creator" content="@Javier López" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Javier López"},"dateModified":"2014-04-08T00:00:00+00:00","datePublished":"2014-04-08T00:00:00+00:00","description":"backups with rsync and rdiff-backup","headline":"backups with rsync and rdiff-backup","mainEntityOfPage":{"@type":"WebPage","@id":"javier.io/blog/en/2014/04/08/backups-git-rsync-rdiff-backup.html"},"url":"javier.io/blog/en/2014/04/08/backups-git-rsync-rdiff-backup.html"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="shortcut icon" href="//javier.io/favicon.ico">
    <link href='//fonts.googleapis.com/css?family=Exo+2:200|PT+Sans|Strait|Vollkorn|' rel='stylesheet' type='text/css'>
    <!--<link href='//fonts.googleapis.com/css?family=Megrim|Ruluko|Exo+2:200|PT+Sans|Strait|Vollkorn|' rel='stylesheet' type='text/css'>-->
    <link rel="alternate" type="application/atom+xml" href="/atom.xml">
    <link rel="stylesheet" type="text/css" href="/assets/css/default_black.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/responsive.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/fontawesome.min.css">

    <!-- syntax http://shjs.sourceforge.net/-->
    <link type="text/css" rel="stylesheet" href="/assets/css/shjs/sh_darkness.css">

    <title>backups with rsync and rdiff-backup</title>
  </head>

  <body onload="sh_highlightDocument('/assets/js/lang/', '.js');">
    <div id="header">
  <h1><a href="/blog/">Javier L&oacute;pez</a>
    <form>
      <input type="text" id="st-search-input" class="st-search-input"/>
    </form>
  </h1>

  <a href="/blog/en.html" class="red">[EN]</a> |
  <a href="/blog/pt.html" class="green">[PT]</a> |
  <a href="/blog/es.html" class="yellow">[ES]</a> |
  <a href="/atom.xml" class="rss">RSS</a> |

  

  <!-- Begin Swifttype -->
  <script type="text/javascript">
    var Swiftype = window.Swiftype || {};
    (function() {
      Swiftype.key = 'k64dV6Rm9QK4z8WnkrcN';
      Swiftype.inputElement = '#st-search-input';
      Swiftype.resultContainingElement = '#st-results-container';
      Swiftype.attachElement = '#st-search-input';
      Swiftype.renderStyle = "new_page";
      Swiftype.resultPageURL = "/blog/results/";

      var script = document.createElement('script');
      script.type = 'text/javascript';
      script.async = true;
      script.src = "//swiftype.com/embed.js";
      var entry = document.getElementsByTagName('script')[0];
      entry.parentNode.insertBefore(script, entry);
    }());
  </script>
  <!-- End Swifttype -->


</div>


    <div id="content">
      <div id="post">
  <h2 id="backups-with-rsync-and-rdiff-backup">backups with rsync and rdiff-backup</h2>

<h6 id="08-apr-2014">08 Apr 2014</h6>

<p>I don’t remember the last time I lost information, that’s been mostly luck since I’m not really careful with my data. However with internet providers increasing bandwidth, efficient compression algorithms all around and affordable servers in the cloud I finally decided to give up my luck and automate my backup plan.</p>

<p>I’m fortunate to work in an homogeneous environment, Linux x32/x64 boxes, so I can cling to the lowest common denominator, on this case ssh/rsync. Both are installed (or available through default repositories) in virtually all Linux distributions and are secure, mature, efficient and well supported, there is a little issue with them though, they’ve too many options and can be tricky to remember.</p>

<p>So, with that in mind I grouped my favorite preferences and created a <a href="https://github.com/javier-lopez/learn/blob/master/sh/tools/backup-remote-rsync">wrapper script</a>. That’s what I use to backup machines, it works like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ backup-remote-rsync -r b.javier.io #the program will backup $HOME to b.javier.io:~/hostname using default ssh keys
$ backup-remote-rsync -r b.javier.io -u admin -k /home/admin/.ssh/id_rsa /var/www /etc
#the program will backup /var/www and /etc to b.javier.io:~/hostname, while using admin's public ssh keys
</code></pre></div></div>

<p>The above lines can be added to a cronjob to remove human dependency:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo cronjob -l
#every day at 22:00
0 22 * * * backup-remote-rsync -r backup.javier.io -u admin -i /home/admin/.ssh/id_rsa /home/admin
</code></pre></div></div>

<p>It’s well known than rsync transfers files using a delta based mechanism, so once the initial backup is done further invocations are considerably faster, this is a great incentive to run backups often.</p>

<p>On the server side, I used <a href="http://www.nongnu.org/rdiff-backup/examples.html">rdiff-backup</a> to create dailies/weeklies/monthlies.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0 1 * * * rdiff-backup /home/admin/backup/ /home/admin/recover/daily
0 2 * * * rdiff-backup --remove-older-than 6D /home/admin/recover/daily

0 1 * * 0 rdiff-backup /home/admin/backup/ /home/admin/recover/weekly
0 2 * * 0 rdiff-backup --remove-older-than 3W /home/admin/recover/weekly

0 1 1 * * rdiff-backup /home/admin/backup/ /home/admin/recover/monthly
0 2 1 * * rdiff-backup --remove-older-than 12M /home/admin/recover/monthly
</code></pre></div></div>

<p>And added <a href="https://github.com/javier-lopez/learn/blob/master/sh/tools/share-backup">share-backup</a>, to provide fast and secure access to single files. Complete recoveries are available through standard rsync.</p>

<p><code class="language-plaintext highlighter-rouge">share-backup</code> usage example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ssh admin@b.javier.io share-backup
Starting server ...
  address   : http://b.javier.io:7648
  username: guest
  password: M2U4ZDRj
  ssl     :
  serving:  /home/admin/recovery

Run: share-backup stop, to stop sharing

$ ssh admin@b.javier.io share-backup stop
Stopped
</code></pre></div></div>

<h2 id="decisions">Decisions</h2>

<p>While testing backup utilities and differente strategies I found me asking me priority questions, is it more important to save hard disk space or to keep several copies around?, does the backup plan require third party integrations or can it be generic?, how many resources in time and money am I willing to invest?, how fast the recovery process must be?, how private the data is?.</p>

<p>I tried to answer these questions as honestly as possible and found than the above procesure covers me in most situations, that doesn’t mean it will work for your. I urge you to test as many alternatives as possible and only stick with those that make you feel confortable and secure. If you’re out of ideas take a look at:</p>

<ul>
  <li><a href="http://www.magiksys.net/ddumbfs/">ddumbfs</a></li>
  <li><a href="https://btrfs.wiki.kernel.org/index.php/Main_Page">btrfs</a></li>
  <li><a href="https://github.com/s3fs-fuse/s3fs-fuse">s3fs</a></li>
  <li><a href="http://opendedup.org/">opendedup</a></li>
  <li><a href="https://github.com/bup/bup">bup</a></li>
  <li><a href="http://obnam.org/">obnam</a></li>
  <li><a href="http://bacula.org/">bacula</a></li>
  <li><a href="https://en.wikipedia.org/wiki/List_of_backup_software">etc</a>.</li>
</ul>

<p>That’s it, stay safe and backup your data now 😋!</p>

</div>

<div id="related">
  <h5>Related Entries:</h5>
  <ul class="related-posts">
    
    <li><span>22 Aug 2018</span> &raquo; <a href="/blog/en/2018/08/22/minos-a-tiling-wm-linux-distro.html">minos, a tiling wm linux distribution</a></li>
    
    <li><span>01 Jan 2012</span> &raquo; <a href="/blog/en/2012/01/01/bash-autocompletion.html">bash autocompletion</a></li>
    
    <li><span>26 Jan 2014</span> &raquo; <a href="/blog/en/2014/01/26/introduction-to-drupal-7-installation-profiles.html">introduction to drupal 7 installation profiles</a></li>
    
  </ul>
</div>

    <div id="disqus">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'javierlopez'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
       dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
       })();
     </script>
     <noscript>Enable JavaScript to see/create comments</noscript>
    </div>


    </div>

    
<div id="footer">

  <div class="link" align="right">
    <a href="//javier.io/blog"><i class="icon-pencil"></i></a>
    <a href="//javier.io/pgp"><i class="icon-key"></i></a>
    <a href="//javier.io/twitter"><i class="icon-twitter"></i></a>
    <a href="//javier.io/github"><i class="icon-github-alt"></i></a>
  </div>
</div>

    

    <!-- syntax http://shjs.sourceforge.net/-->
    <script type="text/javascript" src="/assets/js/shjs/shjs_main.js"></script>

    <!-- lightbox http://gettopup.com, the other part of the lib is called in the post.html file-->
    <script type="text/javascript" src="/assets/js/top-up/top_up-min.js"></script>
    <script type="text/javascript">TopUp.host = "//javier.io/";</script>
    <script type="text/javascript">TopUp.images_path = "assets/js/top-up/images/";</script>
    <script type="text/javascript">
      TopUp.addPresets({
          "#content strong a": {
            readAltText: 1,
            effect: "clip",
            overlayClose: 0,
            shaded: 1,
            group: "img"
          }
    });
    </script>

    <!-- google analytics -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-47664650-1']);
      _gaq.push(['_trackPageview']);

      (function() {
       var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
       ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
       var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
       })();
    </script>

  </body>
</html>
