<!DOCTYPE html>
<html>
  <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="keywords" content="Javier López personal blog">
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>introduction to drupal 7 installation profiles | javier.io</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="introduction to drupal 7 installation profiles" />
<meta name="author" content="Javier López" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="introduction to drupal 7 installation profiles" />
<meta property="og:description" content="introduction to drupal 7 installation profiles" />
<link rel="canonical" href="javier.io/blog/en/2014/01/26/introduction-to-drupal-7-installation-profiles.html" />
<meta property="og:url" content="javier.io/blog/en/2014/01/26/introduction-to-drupal-7-installation-profiles.html" />
<meta property="og:site_name" content="javier.io" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-01-26T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="introduction to drupal 7 installation profiles" />
<meta name="twitter:site" content="@javier_flpz" />
<meta name="twitter:creator" content="@Javier López" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Javier López"},"dateModified":"2014-01-26T00:00:00+00:00","datePublished":"2014-01-26T00:00:00+00:00","description":"introduction to drupal 7 installation profiles","headline":"introduction to drupal 7 installation profiles","mainEntityOfPage":{"@type":"WebPage","@id":"javier.io/blog/en/2014/01/26/introduction-to-drupal-7-installation-profiles.html"},"url":"javier.io/blog/en/2014/01/26/introduction-to-drupal-7-installation-profiles.html"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="shortcut icon" href="//javier.io/favicon.ico">
    <link href='//fonts.googleapis.com/css?family=Exo+2:200|PT+Sans|Strait|Vollkorn|' rel='stylesheet' type='text/css'>
    <!--<link href='//fonts.googleapis.com/css?family=Megrim|Ruluko|Exo+2:200|PT+Sans|Strait|Vollkorn|' rel='stylesheet' type='text/css'>-->
    <link rel="alternate" type="application/atom+xml" href="/atom.xml">
    <link rel="stylesheet" type="text/css" href="/assets/css/default_black.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/responsive.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/fontawesome.min.css">

    <!-- syntax http://shjs.sourceforge.net/-->
    <link type="text/css" rel="stylesheet" href="/assets/css/shjs/sh_darkness.css">

    <title>introduction to drupal 7 installation profiles</title>
  </head>

  <body onload="sh_highlightDocument('/assets/js/lang/', '.js');">
    <div id="header">
  <h1><a href="/blog/">Javier L&oacute;pez</a>
    <form>
      <input type="text" id="st-search-input" class="st-search-input"/>
    </form>
  </h1>

  <a href="/blog/en.html" class="red">[EN]</a> |
  <a href="/blog/pt.html" class="green">[PT]</a> |
  <a href="/blog/es.html" class="yellow">[ES]</a> |
  <a href="/atom.xml" class="rss">RSS</a> |

  

  <!-- Begin Swifttype -->
  <script type="text/javascript">
    var Swiftype = window.Swiftype || {};
    (function() {
      Swiftype.key = 'k64dV6Rm9QK4z8WnkrcN';
      Swiftype.inputElement = '#st-search-input';
      Swiftype.resultContainingElement = '#st-results-container';
      Swiftype.attachElement = '#st-search-input';
      Swiftype.renderStyle = "new_page";
      Swiftype.resultPageURL = "/blog/results/";

      var script = document.createElement('script');
      script.type = 'text/javascript';
      script.async = true;
      script.src = "//swiftype.com/embed.js";
      var entry = document.getElementsByTagName('script')[0];
      entry.parentNode.insertBefore(script, entry);
    }());
  </script>
  <!-- End Swifttype -->


</div>


    <div id="content">
      <div id="post">
  <h2 id="introduction-to-drupal-7-installation-profiles">introduction to drupal 7 installation profiles</h2>

<h6 id="26-jan-2014">26 Jan 2014</h6>

<p><strong><a href="/assets/img/91.gif"><img src="/assets/img/91.gif" alt="" /></a></strong></p>

<p>Last weekend I worked on a Drupal site and it was not fun =( mostly due to incomplete and inaccurate documentation. My goal was to create a distributable bundle for <a href="https://github.com/javier-lopez/ubuntu-mx-www">Spanish Ubuntu</a> local teams. I already had a base theme and didn’t though it could be that hard, however what started as a simple task ended as a very long weekend. On this post I’ll try to document what issues I found and how they were worked out.</p>

<p>For the record, I must say I’m not a web developer, I find all the technologies related quite difficult to understand, I also didn’t have any previous experience with drupal internals.</p>

<p>Since the beginning I though any work should be automatized as much as possible, ideally an administrator would be able to download the bundle, throw it away on the file system, run the web installer and start creating content. The result happily is quite similar:</p>

<ul>
  <li>Download and place the bundle in a directory read by a web server (eg, apache)</li>
  <li>Go to the server ip</li>
  <li>Select the ‘Ubuntu-mx’ profile</li>
  <li>On a Spanish translated interface, input the database settings</li>
  <li>Configure the administrator credentials</li>
  <li>Create content</li>
</ul>

<p>The resulting site would be translated to spanish, will enable a bunch of modules (l10n_update, admin_menu, smtp, ckeditor), an Ubuntu theme, search permissions and menu links.</p>

<p>For this to work, I used:</p>

<ul>
  <li><a href="https://drupal.org/node/1022020">installation profiles</a></li>
  <li><a href="https://drupal.org/project/features">feature modules</a></li>
</ul>

<h2 id="installation-profiles">Installation profiles</h2>

<p>Installation profiles are special modules who allow you to declare which modules, languages and themes to load by default, they can also be used to modify the installer to add or remove steps.</p>

<p>They must have a <a href="https://drupal.org/taxonomy/term/33388">.info</a>, <a href="https://api.drupal.org/api/drupal/modules!profile!profile.module/7">.profile</a> and <a href="https://api.drupal.org/api/drupal/includes!install.core.inc/function/install_tasks/7">.install</a> files at:</p>

<ul>
  <li><strong>/profiles/profile_name/</strong></li>
</ul>

<p>I named my module <strong>‘umx’</strong></p>

<h3 id="info">.info</h3>

<p>This file contains name, description, drupal version and dependencies (modules enabled by default):</p>

<p><strong>declaring only core modules as dependencies</strong></p>

<p>The content of my <strong>/profiles/umx/umx.info</strong> file was:</p>

<pre class="sh_properties">
name        = Ubuntu-mx
description = Install Ubuntu-mx modules, language (es) and configuration
version     = 0.1
core        = 7.x

dependencies[] = block
dependencies[] = color
dependencies[] = comment
dependencies[] = contextual
dependencies[] = dashboard
dependencies[] = help
dependencies[] = image
dependencies[] = list
dependencies[] = number
dependencies[] = options
dependencies[] = path
dependencies[] = taxonomy
dependencies[] = dblog
dependencies[] = shortcut
dependencies[] = overlay
dependencies[] = field_ui
dependencies[] = file
dependencies[] = rdf

dependencies[] = umx_conf
</pre>

<p>I found much more comfortable to declare only core modules as dependencies and carry on the rest of the configuration in a separate module (generated by the features module). This way I can keep using the same unmodified profile and alter the resulting site by regenerating the umx_conf module when necessary.</p>

<h3 id="profile">.profile</h3>

<p>On the <strong>.profile</strong> and <strong>.install</strong> files can be written functions to override/define hooks, I used <strong>/profile/umx/umx.profile</strong> to configure the default language to spanish (as a result the language dialogue is skipped):</p>

<pre class="sh_php">
function umx_profile_details() {
    $details['language'] = "es";
    return $details;
}
</pre>

<p>The default language can also be configured in a feature module (on this example, <strong>umx_conf</strong>) however if doing so, the installation process itself will run in English, and if it’s double declared (here and in a feature module), the installation will return a sql duplication key error.</p>

<p>It’s not optimal, but it’s the best I could do. I located the es.po file at:</p>

<ul>
  <li><strong>/profiles/umx/translations/es.po</strong></li>
</ul>

<p>The localize.drupal.org server has po files with a drupal version prefix, if downloaded from there, you should rename them. Eg</p>

<pre>
    drupal-7.26.es.po -&gt; es.po
</pre>

<ul>
  <li><a href="https://drupal.org/node/1326106">https://drupal.org/node/1326106</a></li>
</ul>

<h3 id="install">.install</h3>

<p>Here you can override install, update and uninstall functions. Since the feature modules doesn’t support theme settings (something who could be really useful) I declared the default theme on this file (<strong>/profile/umx/umx.install</strong>):</p>

<pre class="sh_php">
function umx_install() {
    db_update('system')
        -&gt;fields(array('status' =&gt; 1))
        -&gt;condition('type', 'theme')
        -&gt;condition('name', 'umxtheme')
        -&gt;execute();
    variable_set('theme_default', 'umxtheme');
}
</pre>

<p>According to the documentation, theme settings should be declared in <strong>profile_themes_enabled()</strong> with the <strong>theme_enable()</strong> function, however I was unable to make to work any of them.</p>

<p>Snippets which did <strong>NOT</strong> work (drupal 7.26):</p>

<pre class="sh_php">
function umx_themes_enabled() {
    //any code;
}
</pre>

<pre class="sh_php">
function umx_install_finished() {
    //any code;
}
</pre>

<pre class="sh_php">
function umx_update_N() {
    //any code;
}
</pre>

<pre class="sh_php">
function umx_install() {
    variable_set('theme_default','umxtheme');
}
</pre>

<pre class="sh_php">
function umx_install() {
    $list_themes = list_themes(TRUE);
    $major_version = (int)VERSION;

    $theme_default = isset($list_themes['umxtheme']) ? 'umxtheme' : 'garland';
    $admin_theme   = isset($list_themes['seven']) ? 'seven' : 'garland';

    variable_set('theme_default', $theme_default);
    theme_enable($theme_default);
    theme_disable(array('bartik'));

    if($affect_admin_theme){
        variable_set('admin_theme', $admin_theme);
    }

    if (module_exists('switchtheme')) {
        if (empty($_GET['theme']) || $_GET['theme'] !== $theme_default) {
            $query = array(
                'theme' =&gt; $theme_default
            ); 
            if($major_version &lt; 7){
                $options = $query;
            }
            else{
                $options = array('query' =&gt; $query);
            }

            drupal_goto($_GET['q'], $options);
        }
    }
}
</pre>

<pre class="sh_php">
function umx_install() {
    $enable = array(
        'theme_default' =&gt; 'umxtheme',
        'admin_theme'   =&gt; 'seven',
    );
    theme_enable($enable);

    foreach ($enable as $var =&gt; $theme) {
        if (!is_numeric($var)) {
            variable_set($var, $theme);
        }
    }

    theme_disable(array('bartik'));
}
</pre>

<p>Drupal themes must be placed at:</p>

<ul>
  <li><strong>/sites/all/themes</strong></li>
</ul>

<p>One lesson I learned was that themes should be named clearly, at the beginning I declared the theme as ‘umx’ (for ubuntu-mx theme) and put it in <strong>/sites/all/themes/umx-theme/</strong>, later on while trying to configure the bundle with a default theme I got confused because the profile installation was named equal and I was not sure which one I was referring to. Name your themes with a unique string, (I finally decided to rename ‘umx’ to ‘umxtheme’).</p>

<p>Ignore the <strong>name</strong> field written in the <em>.info</em> file, and prefix your hook functions with the selected drupal theme (e,g, umxtheme_footer_text())</p>

<ul>
  <li><a href="http://www.computerminds.co.uk/articles/setting-default-theme-during-installation">Setting default theme for Drupal</a></li>
  <li><a href="http://codedrup.blogspot.mx/2012/10/setting-different-default-theme-by.html">Setting a different default theme by default in an install profile</a></li>
  <li><a href="http://www.isaacsukin.com/news/2011/01/10/how-write-drupal-7-installation-profile">how to write a drupal 7 installation profile</a></li>
</ul>

<h2 id="feature-modules">Feature modules</h2>

<p>Feature modules are good for bundling configurations, permissions and dependencies on non default modules. I created <strong>umx_conf</strong> to iterate faster. Using feature modules you can modify drupal settings through a browser and then export the result to code from the feature menu.</p>

<p>Autogenerated features modules can contain:</p>

<ul>
  <li><em>.info</em></li>
  <li><em>.module</em></li>
  <li><em>.feature.submodule.inc</em></li>
</ul>

<p>Very few times you would need to modify them directly. In my experience (a weekend) the autogenerated files will sometimes contain mistakes, therefore I modified them slightly to feet my needs:</p>

<h3 id="info-1">.info</h3>

<p>On this file, dependencies are declared, the generator makes a quite clever job adding recursively all the dependencies your configurations depend on.</p>

<pre class="sh_properties">
name        = umx conf
description = Common settings for the Ubuntu-mx local portal.
core        = 7.x
package     = Features
version     = 7.x-0.1
project     = umx_conf

dependencies[] = admin_menu
dependencies[] = admin_menu_toolbar
dependencies[] = ckeditor
dependencies[] = features
dependencies[] = l10n_update
dependencies[] = locale
dependencies[] = menu
dependencies[] = search
dependencies[] = smtp

features[ckeditor_profile][] = Advanced
features[ckeditor_profile][] = CKEditor Global Profile
features[ckeditor_profile][] = Full

features[features_api][]     = api:2
features[user_permission][]  = search content
features[user_permission][]  = use advanced search

features[menu_custom][] = main-menu
features[menu_links][]  = main-menu_portada:&lt;front&gt;
features[menu_links][]  = main-menu_foros:http://google.com
features[menu_links][]  = main-menu_preguntas:http://ubuntu.shapado.com
features[menu_links][]  = main-menu_wiki:https://wiki.ubuntu.com/UbuntuMxTeam
features[menu_links][]  = main-menu_chat:http://google.com
features[menu_links][]  = main-menu_descargar-ubuntu:http://google.com
</pre>

<h3 id="module">.module</h3>

<p>On this file, you can override hook functions, I leave it blank</p>

<h3 id="featuresubmoduleinc">.feature.submodule.inc</h3>

<p>On these files per module configurations are saved, in my case, I had to modify <strong>/sites/all/modules/umx_conf/umx_conf.features.menu_links.inc</strong> because some links weren’t exported.</p>

<pre class="sh_php">
function umx_conf_menu_default_menu_links() {
  $menu_links = array();
  $menu_links['main-menu_portada:&lt;front&gt;'] = array(
    'menu_name' =&gt; 'main-menu',
    'link_path' =&gt; '&lt;front&gt;',
    'router_path' =&gt; '',
    'link_title' =&gt; 'Portada',
    'options' =&gt; array(
      'attributes' =&gt; array(
        'title' =&gt; '',
      ),
      'identifier' =&gt; 'main-menu_portada:&lt;front&gt;',
    ),
    'module' =&gt; 'menu',
    'hidden' =&gt; 0,
    'external' =&gt; 1,
    'has_children' =&gt; 0,
    'expanded' =&gt; 0,
    'weight' =&gt; 0,
    'customized' =&gt; 1,
  );

  ...
</pre>

<p>I had to adjust mostly the <strong>weight</strong> parameter and add missing links. Not difficult if you follow the syntax (even if you don’t know php).</p>

<ul>
  <li><a href="http://www.youtube.com/watch?v=DxRBEaD9JCA">Introduction to drupal module features</a></li>
</ul>

<h2 id="extra">Extra</h2>

<p>If you had problems with the above description, a probably better and more up-to-date approach to profile Drupal installation is described at:</p>

<ul>
  <li><a href="http://salsadigital.com.au/news/drupal-installation-profile-and-distributions">http://salsadigital.com.au/news/drupal-installation-profile-and-distributions</a></li>
</ul>

<p>That’s it, I hope this information can save some time to someone, have fun!</p>

</div>

<div id="related">
  <h5>Related Entries:</h5>
  <ul class="related-posts">
    
    <li><span>01 Jan 2012</span> &raquo; <a href="/blog/en/2012/01/01/bash-autocompletion.html">bash autocompletion</a></li>
    
    <li><span>30 Jan 2025</span> &raquo; <a href="/blog/en/2025/01/30/nvim-migration.html">nvim migration</a></li>
    
    <li><span>22 Aug 2018</span> &raquo; <a href="/blog/en/2018/08/22/minos-a-tiling-wm-linux-distro.html">minos, a tiling wm linux distribution</a></li>
    
  </ul>
</div>

    <div id="disqus">
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'javierlopez'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
       var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
       dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
       })();
     </script>
     <noscript>Enable JavaScript to see/create comments</noscript>
    </div>


    </div>

    
<div id="footer">

  <div class="link" align="right">
    <a href="//javier.io/blog"><i class="icon-pencil"></i></a>
    <a href="//javier.io/pgp"><i class="icon-key"></i></a>
    <a href="//javier.io/twitter"><i class="icon-twitter"></i></a>
    <a href="//javier.io/github"><i class="icon-github-alt"></i></a>
  </div>
</div>

    

    <!-- syntax http://shjs.sourceforge.net/-->
    <script type="text/javascript" src="/assets/js/shjs/shjs_main.js"></script>

    <!-- lightbox http://gettopup.com, the other part of the lib is called in the post.html file-->
    <script type="text/javascript" src="/assets/js/top-up/top_up-min.js"></script>
    <script type="text/javascript">TopUp.host = "//javier.io/";</script>
    <script type="text/javascript">TopUp.images_path = "assets/js/top-up/images/";</script>
    <script type="text/javascript">
      TopUp.addPresets({
          "#content strong a": {
            readAltText: 1,
            effect: "clip",
            overlayClose: 0,
            shaded: 1,
            group: "img"
          }
    });
    </script>

    <!-- google analytics -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-47664650-1']);
      _gaq.push(['_trackPageview']);

      (function() {
       var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
       ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
       var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
       })();
    </script>

  </body>
</html>
